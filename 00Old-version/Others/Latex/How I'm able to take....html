<html id="html-top" lang="zh"><head><meta charset="UTF-8"><title>How I'm able to take notes in mathematics lectures using LaTeX and Vim</title><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><link rel="icon" href="https://cubox.pro/my/favicon.svg" type="image/x-icon"><link href="https://cubox.pro/article/css/reader.css" rel="stylesheet" /><script type="text/javascript" src="https://cubox.pro/article/js/iconfont.js"></script></head><body ontouchstart><div class="reader-page"><div><h1 class="reader-title">How I'm able to take notes in mathematics lectures using LaTeX and Vim</h1><div class="reader-metadata"><a  href="https://castel.dev/post/lecture-notes-1/" target="_blank">castel.dev</a></div><div> 
 <div> 
  <p>A while back I answered a question on Quora: <a rel="nofollow noopener noreferrer" href="https://www.quora.com/Can-people-actually-keep-up-with-note-taking-in-Mathematics-lectures-with-LaTeX/answer/Gilles-Castel-1" target="_blank">Can people actually keep up with note-taking in Mathematics lectures with LaTeX</a>. There, I explained my workflow of taking lecture notes in LaTeX using Vim and how I draw figures in Inkscape. However, a lot has changed since then and I’d like to write a few blog posts explaining my workflow.</p> 
 </div> 
 <p>I started using LaTeX to write lecture notes in the second semester of my bachelor in mathematics, and I’ve been using it ever since, which makes for a total of more than 1700 pages of notes. To give you an idea of what those notes look like, here are some examples:</p> 
 <p><span> <a rel="noopener" href="https://castel.dev/static/ba66c52b01c8fe6b31c97af52b5eb7f7/c2c88/ca1.png" target="_blank"> <span></span> <img data-archive-loading="lazy" decoding="async"  srcset="https://castel.dev/static/ba66c52b01c8fe6b31c97af52b5eb7f7/e3b59/ca1.png 170w,
https://castel.dev/static/ba66c52b01c8fe6b31c97af52b5eb7f7/d6fe0/ca1.png 340w,
https://castel.dev/static/ba66c52b01c8fe6b31c97af52b5eb7f7/a4de1/ca1.png 680w,
https://castel.dev/static/ba66c52b01c8fe6b31c97af52b5eb7f7/e9ece/ca1.png 1020w,
https://castel.dev/static/ba66c52b01c8fe6b31c97af52b5eb7f7/c2c88/ca1.png 1173w" src="https://cubox.pro/c/filters:no_upscale()?imageUrl=https%3A%2F%2Fcastel.dev%2Fstatic%2Fba66c52b01c8fe6b31c97af52b5eb7f7%2Fa4de1%2Fca1.png" title="ca1"> </a> </span> <span> <a rel="noopener" href="https://castel.dev/static/1a393ac73dbb96f6fbd98b258e8a325a/a78ad/ca2.png" target="_blank"> <span></span> <img data-archive-loading="lazy" decoding="async"  srcset="https://castel.dev/static/1a393ac73dbb96f6fbd98b258e8a325a/e3b59/ca2.png 170w,
https://castel.dev/static/1a393ac73dbb96f6fbd98b258e8a325a/d6fe0/ca2.png 340w,
https://castel.dev/static/1a393ac73dbb96f6fbd98b258e8a325a/a4de1/ca2.png 680w,
https://castel.dev/static/1a393ac73dbb96f6fbd98b258e8a325a/e9ece/ca2.png 1020w,
https://castel.dev/static/1a393ac73dbb96f6fbd98b258e8a325a/a78ad/ca2.png 1163w" src="https://cubox.pro/c/filters:no_upscale()?imageUrl=https%3A%2F%2Fcastel.dev%2Fstatic%2F1a393ac73dbb96f6fbd98b258e8a325a%2Fa4de1%2Fca2.png" title="ca2"> </a> </span> <span> <a rel="noopener" href="https://castel.dev/static/cb323a2ec665d98f93f78e13d3972e0e/73116/ca3.png" target="_blank"> <span></span> <img data-archive-loading="lazy" decoding="async"  srcset="https://castel.dev/static/cb323a2ec665d98f93f78e13d3972e0e/e3b59/ca3.png 170w,
https://castel.dev/static/cb323a2ec665d98f93f78e13d3972e0e/d6fe0/ca3.png 340w,
https://castel.dev/static/cb323a2ec665d98f93f78e13d3972e0e/a4de1/ca3.png 680w,
https://castel.dev/static/cb323a2ec665d98f93f78e13d3972e0e/e9ece/ca3.png 1020w,
https://castel.dev/static/cb323a2ec665d98f93f78e13d3972e0e/73116/ca3.png 1155w" src="https://cubox.pro/c/filters:no_upscale()?imageUrl=https%3A%2F%2Fcastel.dev%2Fstatic%2Fcb323a2ec665d98f93f78e13d3972e0e%2Fa4de1%2Fca3.png" title="ca3"> </a> </span></p> 
 <p>These lecture notes — including figures — are made while attending the lecture and have not been edited afterwards. To make note taking using LaTeX viable, I had four goals in mind:</p> 
 <ul> 
  <li>Writing text and mathematical formulas in LaTeX should be as fast as the lecturer writing on a blackboard: no delay is acceptable.</li> 
  <li>Drawing figures should be almost as fast as the lecturer.</li> 
  <li>Managing notes, i.e. adding a note, compiling all my notes, compiling the last two lectures, searching in notes, etc. should be easy and quick.</li> 
  <li>Annotating pdf documents using LaTeX should be possible for when I want to write notes alongside a pdf document.</li> 
 </ul> 
 <p>This blog post will focus on the first item: writing LaTeX.</p> 
 <div> 
  <ul> 
   <li><span>Vim and LaTeX</span></li> 
   <li> <p><span>Snippets</span></p> 
    <ul> 
     <li><span>What’s a snippet?</span></li> 
     <li><span>Using UltiSnips to create snippets</span></li> 
    </ul> </li> 
   <li> <p><span>LaTeX snippets</span></p> 
    <ul> 
     <li><span>Environments</span></li> 
     <li><span>Inline and display math</span></li> 
     <li><span>Sub- and superscripts</span></li> 
     <li><span>Fractions</span></li> 
     <li><span>Sympy and Mathematica</span></li> 
     <li><span>Postfix snippets</span></li> 
     <li><span>Other snippets</span></li> 
     <li><span>Course specific snippets</span></li> 
     <li><span>Context</span></li> 
    </ul> </li> 
   <li><span>Correcting spelling mistakes on the fly</span></li> 
   <li><span>In conclusion</span></li> 
  </ul> 
 </div> 
 <h2>Vim and LaTeX</h2> 
 <p>For writing text and mathematical formulas in LaTeX, I use Vim. Vim is a powerful general purpose text editor that’s very extensible. I use it for writing code, LaTeX, markdown, … basically everything that’s text-based. It has a fairly steep learning curve, but once you’ve got the basics down, it’s hard to get back to an editor without Vim keybindings. Here’s what my screen looks like when I’m editing LaTeX:</p> 
 <p><span> <a rel="noopener" href="https://castel.dev/static/4282d15d03150c89182ab56634d2b4b0/d7e34/vimzathura.png" target="_blank"> <span></span> <img data-archive-loading="lazy" decoding="async"  srcset="https://castel.dev/static/4282d15d03150c89182ab56634d2b4b0/e3b59/vimzathura.png 170w,
https://castel.dev/static/4282d15d03150c89182ab56634d2b4b0/d6fe0/vimzathura.png 340w,
https://castel.dev/static/4282d15d03150c89182ab56634d2b4b0/a4de1/vimzathura.png 680w,
https://castel.dev/static/4282d15d03150c89182ab56634d2b4b0/e9ece/vimzathura.png 1020w,
https://castel.dev/static/4282d15d03150c89182ab56634d2b4b0/e0c87/vimzathura.png 1360w,
https://castel.dev/static/4282d15d03150c89182ab56634d2b4b0/d7e34/vimzathura.png 1919w" src="https://cubox.pro/c/filters:no_upscale()?imageUrl=https%3A%2F%2Fcastel.dev%2Fstatic%2F4282d15d03150c89182ab56634d2b4b0%2Fa4de1%2Fvimzathura.png" title="Vim and Zathura"> </a> </span></p> 
 <p>On the left you see Vim and on the right my pdf viewer, <a rel="nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Zathura_(document_viewer)" target="_blank">Zathura</a>, which also has Vim-like keybindings. I’m using Ubuntu with <a rel="nofollow noopener noreferrer" href="https://github.com/baskerville/bspwm" target="_blank">bspwm</a> as my window manager. The LaTeX plugin I’m using in Vim is <a rel="nofollow noopener noreferrer" href="https://github.com/lervag/vimtex" target="_blank">vimtex</a>. It provides syntax highlighting, table of contents view, synctex, etc. Using <a rel="nofollow noopener noreferrer" href="https://github.com/junegunn/vim-plug" target="_blank">vim-plug</a>, I configured it as follows:</p> 
 <div data-language="vim"> 
  <pre><code>Plug <span>'lervag/vimtex'</span>
<span>let</span> g<span>:</span>tex_flavor<span>=</span><span>'latex'</span>
<span>let</span> g<span>:</span>vimtex_view_method<span>=</span><span>'zathura'</span>
<span>let</span> g<span>:</span>vimtex_quickfix_mode<span>=</span><span>0</span>
<span>set</span> conceallevel<span>=</span><span>1</span>
<span>let</span> g<span>:</span>tex_conceal<span>=</span><span>'abdmg'</span></code></pre> 
 </div> 
 <p>The last two lines configure the concealment. This is a feature where LaTeX code is replaced or made invisible when your cursor is not on that line. By making <code>\[</code>, <code>\]</code>, <code>$</code> invisible, they’re less obtrusive which gives you a better overview of the document. This feature also replaces <code>\bigcap</code> by by <code>∩</code>, <code>\in</code> by <code>∈</code> etc. The following animation should make that clear.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342713145/62756.jpg"></p> 
 <p>With this set up, I come to the crux of this blog post: writing LaTeX as fast as the lecturer can write on the blackboard. This is where snippets come into play.</p> 
 <h2>Snippets</h2> 
 <h3>What’s a snippet?</h3> 
 <p>A snippet is a short reusable piece of text that can be triggered by some other text. For example, when I type <code>sign</code> and press <kbd>Tab</kbd>, the word <code>sign</code> will be expanded to a signature:</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342795580/80437.jpg"></p> 
 <p>Snippets can also be dynamic: when I type <code>today</code> and press <kbd>Tab</kbd>, the word <code>today</code> will be replaced by the current date, and <code>box</code> <kbd>Tab</kbd> becomes a box that automatically grows in size.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342920337/81707.jpg"></p> 
 <p><img src="https://image.cubox.pro/article/2022010814342948934/57169.jpg"></p> 
 <p>You can even use one snippet inside another:</p> 
 <p><img src="https://image.cubox.pro/article/2022010814343031439/81825.jpg"></p> 
 <h3>Using UltiSnips to create snippets</h3> 
 <p>I use the plugin <a rel="nofollow noopener noreferrer" href="https://github.com/SirVer/ultisnips" target="_blank">UltiSnips</a> to manage my snippets. My configuration is</p> 
 <div data-language="vim"> 
  <pre><code>Plug <span>'sirver/ultisnips'</span>
<span>let</span> g<span>:</span>UltiSnipsExpandTrigger <span>=</span> <span>'&lt;tab&gt;'</span>
<span>let</span> g<span>:</span>UltiSnipsJumpForwardTrigger <span>=</span> <span>'&lt;tab&gt;'</span>
<span>let</span> g<span>:</span>UltiSnipsJumpBackwardTrigger <span>=</span> <span>'&lt;s-tab&gt;'</span></code></pre> 
 </div> 
 <p>The code for the <code>sign</code> snippet is the following:</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>sign </span><span>"Signature"</span></span>
Yours sincerely,

Gilles Castel
<span>endsnippet</span></code></pre> 
 </div> 
 <p>For dynamic snippets, you can put code between backticks <code>``</code> which will be run when the snippet is expanded. Here, I’ve used bash to format the current date: <code>date + %F</code>.</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>today </span><span>"Date"</span></span>
`date +%F`
<span>endsnippet</span></code></pre> 
 </div> 
 <p>You can also use Python inside a <code>`!p ... `</code> block. Have a look at the code for the <code>box</code> snippet:</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>box </span><span>"Box"</span></span>
`<span>!p</span><span> snip<span>.</span>rv <span>=</span> <span>'┌'</span> <span>+</span> <span>'─'</span> <span>*</span> <span>(</span><span>len</span><span>(</span>t<span>[</span><span>1</span><span>]</span><span>)</span> <span>+</span> <span>2</span><span>)</span> <span>+</span> <span>'┐'</span>`</span>
│ <span>$1</span> │
`<span>!p</span><span> snip<span>.</span>rv <span>=</span> <span>'└'</span> <span>+</span> <span>'─'</span> <span>*</span> <span>(</span><span>len</span><span>(</span>t<span>[</span><span>1</span><span>]</span><span>)</span> <span>+</span> <span>2</span><span>)</span> <span>+</span> <span>'┘'</span>`</span>
<span>$0</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <p>These Python code blocks will be replaced by the value of the variable <code>snip.rv</code>. Inside these blocks, you have access to the current state of the snippet, e.g. <code>t[1]</code> contains the first tab stop, <code>fn</code> the current filename, …</p> 
 <h2>LaTeX snippets</h2> 
 <p>Using snippets, writing LaTeX is a lot faster than writing it by hand. Especially some of the more complex snippets can save you a lot of time and frustration. Let’s begin with some simple snippets.</p> 
 <h3>Environments</h3> 
 <p>To insert an environment, all I have to do is type <code>beg</code> at the beginning of a line. Then I type the name of the environment, which is mirrored in the <code>\end{}</code> command. Pressing <kbd>Tab</kbd> places the cursor inside the newly created environment.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342929151/20996.jpg"></p> 
 <p>The code for this snippet is the following.</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>beg </span><span>"begin{} / end{}"</span> <span>bA</span></span>
\begin{<span>$1</span>}
	<span>$0</span>
\end{<span>$1</span>}
<span>endsnippet</span></code></pre> 
 </div> 
 <p>The <code>b</code> means that this snippet will only be expanded at the beginning of a line and <code>A</code> stands for auto expand, which means I do not have to press <kbd>Tab</kbd> to expand the snippet. Tab stops — i.e. places you can jump to by pressing <kbd>Tab</kbd> and <kbd>Shift</kbd>+<kbd>Tab</kbd> — are represented by <code>$1</code>, <code>$2</code>, … and the last one with <code>$0</code>.</p> 
 <h3>Inline and display math</h3> 
 <p>Two of my most frequently used snippets are <code>mk</code> and <code>dm</code>. They’re the snippets responsible for starting math mode. The first one is a snippet for inline math, the second one for displayed math.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342927997/98011.jpg"></p> 
 <p>The snippet for inline math is ‘smart’: it knows when to insert a space after the dollar sign. When I start typing a word directly behind the closing <code>$</code>, it adds a space. However, when I type a non-word character, it does not add a space, which would be preferred for example in the case of <code>$p$-value</code>.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342921172/39450.jpg"></p> 
 <p>The code for this snippet is the following.</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>mk </span><span>"Math"</span> <span>wA</span></span>
$<span>${1}</span>$`<span>!p</span><span>
<span>if</span> t<span>[</span><span>2</span><span>]</span> <span>and</span> t<span>[</span><span>2</span><span>]</span><span>[</span><span>0</span><span>]</span> <span>not</span> <span>in</span> <span>[</span><span>','</span><span>,</span> <span>'.'</span><span>,</span> <span>'?'</span><span>,</span> <span>'-'</span><span>,</span> <span>' '</span><span>]</span><span>:</span>
    snip<span>.</span>rv <span>=</span> <span>' '</span>
<span>else</span><span>:</span>
    snip<span>.</span>rv <span>=</span> <span>''</span>
`</span><span>$2</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <p>The <code>w</code> at the end of the first line means that this snippet will expand at word boundaries, so e.g. <code>hellomk</code> won’t expand, but <code>hello mk</code> will.</p> 
 <p>The snippet for displayed math is more simple, but it also is quite handy; it makes me never forget ending equations with a period.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342946891/25725.jpg"></p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>dm </span><span>"Math"</span> <span>wA</span></span>
\[
<span>$1</span>
.\] <span>$0</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <h3>Sub- and superscripts</h3> 
 <p>Another useful snippet is one for subscripts. It changes changes <code>a1</code> to <code>a_1</code> and <code>a_12</code> to <code>a_{12}</code>.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342965300/95832.jpg"></p> 
 <p>The code for this snippet uses a regular expression for its trigger. It expands the snippet when you type a character followed by a digit, which encoded by <code>[A-Za-z]\d</code>, or a character followed by <code>_</code> and two digits: <code>[A-Za-z]_\d\d</code>.</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>'([A-Za-z])(\d)' </span><span>"auto subscript"</span> <span>wrA</span></span>
`<span>!p</span><span> snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span>`_`!p snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>2</span><span>)</span>`</span>
<span>endsnippet</span>

<span>snippet <span>'([A-Za-z])_(\d\d)' </span><span>"auto subscript2"</span> <span>wrA</span></span>
`<span>!p</span><span> snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span>`_<span>{</span>`!p snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>2</span><span>)</span>`</span>}
<span>endsnippet</span></code></pre> 
 </div> 
 <p>When you wrap parts of a regular expression in a group using parenthesis, e.g. <code>(\d\d)</code>, you can use them in the expansion of the snippet via <code>match.group(i)</code> in Python.</p> 
 <p>As for superscripts, I use <code>td</code>, which becomes <code>^{}</code>. However, for squared, cubed, complement and a handful of other common ones, I use dedicated snippets such as <code>sr</code>, <code>cb</code> and <code>comp</code>.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342980212/25385.jpg"></p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>sr </span><span>"^2"</span> <span>iA</span></span>
^2
<span>endsnippet</span>

<span>snippet <span>cb </span><span>"^3"</span> <span>iA</span></span>
^3
<span>endsnippet</span>

<span>snippet <span>compl </span><span>"complement"</span> <span>iA</span></span>
^{c}
<span>endsnippet</span>

<span>snippet <span>td </span><span>"superscript"</span> <span>iA</span></span>
^{<span>$1</span>}<span>$0</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <h3>Fractions</h3> 
 <p>One of my most convenient snippets is one for fractions. This makes the following expansions:</p> 
 <table> 
  <thead> 
   <tr> 
    <th></th> 
    <th></th> 
    <th></th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>//</code></td> 
    <td>→</td> 
    <td><code>\frac{}{}</code></td> 
   </tr> 
   <tr> 
    <td><code>3/</code></td> 
    <td>→</td> 
    <td><code>\frac{3}{}</code></td> 
   </tr> 
   <tr> 
    <td><code>4\pi^2/</code></td> 
    <td>→</td> 
    <td><code>\frac{4\pi^2}{}</code></td> 
   </tr> 
   <tr> 
    <td><code>(1 + 2 + 3)/</code></td> 
    <td>→</td> 
    <td><code>\frac{1 + 2 + 3}{}</code></td> 
   </tr> 
   <tr> 
    <td><code>(1+(2+3)/)</code></td> 
    <td>→</td> 
    <td><code>(1 + \frac{2+3}{})</code></td> 
   </tr> 
   <tr> 
    <td><code>(1 + (2+3))/</code></td> 
    <td>→</td> 
    <td><code>\frac{1 + (2+3)}{}</code></td> 
   </tr> 
  </tbody> 
 </table> 
 <p><img src="https://image.cubox.pro/article/2022010814342955350/83310.jpg"></p> 
 <p>The code for the first one is easy:</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>// </span><span>"Fraction"</span> <span>iA</span></span>
\\frac{<span>$1</span>}{<span>$2</span>}<span>$0</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <p>The second and third examples are made possible using regular expressions to match for expressions like <code>3/</code>, <code>4ac/</code>, <code>6\pi^2/</code>, <code>a_2/</code>, etc.</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>'((\d+)|(\d*)(\\)?([A-Za-z]+)((\^|_)(\{\d+\}|\d))*)/' </span><span>"Fraction"</span> <span>wrA</span></span>
\\frac{`<span>!p</span><span> snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span>`</span>}{<span>$1</span>}<span>$0</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <p>As you can see, regular expressions can become quite overwhelming, but here’s a diagram that should explain it:</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342933898/80115.jpg"></p> 
 <p>In the fourth and fifth cases, it tries to find the matching parenthesis. As this isn’t possible using the regular expression engine of UltiSnips, I resorted to using Python:</p> 
 <div data-language="snip"> 
  <pre><code><span>priority</span> 1000
<span>snippet <span>'^.*\)/' </span><span>"() Fraction"</span> <span>wrA</span></span>
`<span>!p</span><span>
stripped <span>=</span> match<span>.</span>string<span>[</span><span>:</span><span>-</span><span>1</span><span>]</span>
depth <span>=</span> <span>0</span>
i <span>=</span> <span>len</span><span>(</span>stripped<span>)</span> <span>-</span> <span>1</span>
<span>while</span> <span>True</span><span>:</span>
	<span>if</span> stripped<span>[</span>i<span>]</span> <span>==</span> <span>')'</span><span>:</span> depth <span>+=</span> <span>1</span>
	<span>if</span> stripped<span>[</span>i<span>]</span> <span>==</span> <span>'('</span><span>:</span> depth <span>-=</span> <span>1</span>
	<span>if</span> depth <span>==</span> <span>0</span><span>:</span> <span>break</span><span>;</span>
	i <span>-=</span> <span>1</span>
snip<span>.</span>rv <span>=</span> stripped<span>[</span><span>0</span><span>:</span>i<span>]</span> <span>+</span> <span>"\\frac{"</span> <span>+</span> stripped<span>[</span>i<span>+</span><span>1</span><span>:</span><span>-</span><span>1</span><span>]</span> <span>+</span> <span>"}"</span>
`</span>{<span>$1</span>}<span>$0</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <p>The last snippet concerning fractions I’d like to share is one that uses your selection to make a fraction. You can use it by first selecting some text, then pressing <kbd>Tab</kbd>, typing <code>/</code> and pressing <kbd>Tab</kbd> again.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342917505/21499.jpg"></p> 
 <p>The code makes use of the <code>${VISUAL}</code> variable that represents your selection.</p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>/ </span><span>"Fraction"</span> <span>iA</span></span>
\\frac{<span>${VISUAL}</span>}{<span>$1</span>}<span>$0</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <h3>Sympy and Mathematica</h3> 
 <p>Another cool — but less used — snippet is one that uses <a rel="nofollow noopener noreferrer" href="https://www.sympy.org/" target="_blank">sympy</a> to evaluate mathematical expressions. For example: <code>sympy</code> <kbd>Tab</kbd> expands to <code>sympy | sympy</code>, and <code>sympy 1 + 1 sympy</code> <kbd>Tab</kbd> expands to <code>2</code>.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814343096974/67144.jpg"></p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>sympy </span><span>"sympy block "</span> <span>w</span></span>
sympy <span>$1</span> sympy<span>$0</span>
<span>endsnippet</span>

<span>priority</span> 10000
<span>snippet <span>'sympy(.*)sympy' </span><span>"evaluate sympy"</span> <span>wr</span></span>
`<span>!p</span><span>
<span>from</span> sympy <span>import</span> <span>*</span>
x<span>,</span> y<span>,</span> z<span>,</span> t <span>=</span> symbols<span>(</span><span>'x y z t'</span><span>)</span>
k<span>,</span> m<span>,</span> n <span>=</span> symbols<span>(</span><span>'k m n'</span><span>,</span> integer<span>=</span><span>True</span><span>)</span>
f<span>,</span> g<span>,</span> h <span>=</span> symbols<span>(</span><span>'f g h'</span><span>,</span> cls<span>=</span>Function<span>)</span>
init_printing<span>(</span><span>)</span>
snip<span>.</span>rv <span>=</span> <span>eval</span><span>(</span><span>'latex('</span> <span>+</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span><span>.</span>replace<span>(</span><span>'\\'</span><span>,</span> <span>''</span><span>)</span> \
    <span>.</span>replace<span>(</span><span>'^'</span><span>,</span> <span>'**'</span><span>)</span> \
    <span>.</span>replace<span>(</span><span>'{'</span><span>,</span> <span>'('</span><span>)</span> \
    <span>.</span>replace<span>(</span><span>'}'</span><span>,</span> <span>')'</span><span>)</span> <span>+</span> <span>')'</span><span>)</span>
`</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <p>For the Mathematica users out there, you can do something similar:</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342966249/49174.jpg"></p> 
 <div data-language="snip"> 
  <pre><code><span>priority</span> 1000
<span>snippet <span>math </span><span>"mathematica block"</span> <span>w</span></span>
math <span>$1</span> math<span>$0</span>
<span>endsnippet</span>

<span>priority</span> 10000
<span>snippet <span>'math(.*)math' </span><span>"evaluate mathematica"</span> <span>wr</span></span>
`<span>!p</span><span>
<span>import</span> subprocess
code <span>=</span> <span>'ToString['</span> <span>+</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span> <span>+</span> <span>', TeXForm]'</span>
snip<span>.</span>rv <span>=</span> subprocess<span>.</span>check_output<span>(</span><span>[</span><span>'wolframscript'</span><span>,</span> <span>'-code'</span><span>,</span> code<span>]</span><span>)</span>
`</span>
<span>endsnippet</span></code></pre> 
 </div> 
 <h3>Postfix snippets</h3> 
 <p>Some other snippets I find worth sharing are postfix snippets. Examples of such snippets are <code>phat</code> → <code>\hat{p}</code> and <code>zbar</code> → <code>\overline{z}</code>. A similar snippet is a postfix vector, for example <code>v,.</code> → <code>\vec{v}</code> and <code>v.,</code> → <code>\vec{v}</code>. The order of <code>,</code> and <code>.</code> doesn’t matter, so I can press them both at the same time. These snippets are a real time-saver, because you can type in the same order the lecturer writes on the blackboard.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342959980/56885.jpg"></p> 
 <p>Note that I can still use <code>bar</code> and <code>hat</code> prefix too, as I’ve added them with a lower priority. The code for those snippets is:</p> 
 <div data-language="snip"> 
  <pre><code><span>priority</span> 10
<span>snippet <span>"bar" </span><span>"bar"</span> <span>riA</span></span>
\overline{<span>$1</span>}<span>$0</span>
<span>endsnippet</span>

<span>priority</span> 100
<span>snippet <span>"([a-zA-Z])bar" </span><span>"bar"</span> <span>riA</span></span>
\overline{`<span>!p</span><span> snip<span>.</span>rv<span>=</span>match<span>.</span>group<span>(</span><span>1</span><span>)</span>`</span>}
<span>endsnippet</span></code></pre> 
 </div> 
 <div data-language="snip"> 
  <pre><code><span>priority</span> 10
<span>snippet <span>"hat" </span><span>"hat"</span> <span>riA</span></span>
\hat{<span>$1</span>}<span>$0</span>
<span>endsnippet</span>

<span>priority</span> 100
<span>snippet <span>"([a-zA-Z])hat" </span><span>"hat"</span> <span>riA</span></span>
\hat{`<span>!p</span><span> snip<span>.</span>rv<span>=</span>match<span>.</span>group<span>(</span><span>1</span><span>)</span>`</span>}
<span>endsnippet</span></code></pre> 
 </div> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>"(\\?\w+)(,\.|\.,)" </span><span>"Vector postfix"</span> <span>riA</span></span>
\vec{`<span>!p</span><span> snip<span>.</span>rv<span>=</span>match<span>.</span>group<span>(</span><span>1</span><span>)</span>`</span>}
<span>endsnippet</span> </code></pre> 
 </div> 
 <h3>Other snippets</h3> 
 <p>I have about 100 other commonly used snippets. They are available <a rel="nofollow noopener noreferrer" href="https://github.com/gillescastel/latex-snippets" target="_blank">here</a>. Most of them are quite simple. For example, <code>!&gt;</code> becomes <code>\mapsto</code>, <code>-&gt;</code> becomes <code>\to</code>, etc.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342974688/18669.jpg"></p> 
 <p><code>fun</code> becomes <code>f: \R \to \R :</code>, <code>!&gt;</code> → <code>\mapsto</code>, <code>-&gt;</code> → <code>\to</code>, <code>cc</code> → <code>\subset</code>.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814343054293/33417.jpg"></p> 
 <p><code>lim</code> becomes <code>\lim_{n \to \infty}</code>, <code>sum</code> → <code>\sum_{n = 1}^{\infty}</code>, <code>ooo</code> → <code>\infty</code></p> 
 <p><img src="https://image.cubox.pro/article/2022010814342987796/59360.jpg"></p> 
 <p><img src="https://image.cubox.pro/article/2022010814342982471/91170.jpg"></p> 
 <h3>Course specific snippets</h3> 
 <p>Beside my commonly used snippets, I also have course specific snippets. These are loaded by adding the following to my <code>.vimrc</code>:</p> 
 <div data-language="vim"> 
  <pre><code><span>set</span> <span>rtp</span><span>+=</span>~<span>/</span>current_course</code></pre> 
 </div> 
 <p>where <code>current_course</code> is a <a rel="nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Symbolic_link" target="_blank">symlink</a> to my currently activated course (more about that in another blog post). In that folder, I have a file <code>~/current_course/UltiSnips/tex.snippets</code> in which I include course specific snippets. For example, for quantum mechanics, I have snippets for bra/ket notation.</p> 
 <table> 
  <thead> 
   <tr> 
    <th></th> 
    <th></th> 
    <th></th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr> 
    <td><code>&lt;a|</code></td> 
    <td>→</td> 
    <td><code>\bra{a}</code></td> 
   </tr> 
   <tr> 
    <td><code>&lt;q|</code></td> 
    <td>→</td> 
    <td><code>\bra{\psi}</code></td> 
   </tr> 
   <tr> 
    <td><code>|a&gt;</code></td> 
    <td>→</td> 
    <td><code>\ket{a}</code></td> 
   </tr> 
   <tr> 
    <td><code>|q&gt;</code></td> 
    <td>→</td> 
    <td><code>\ket{\psi}</code></td> 
   </tr> 
   <tr> 
    <td><code>&lt;a|b&gt;</code></td> 
    <td>→</td> 
    <td><code>\braket{a}{b}</code></td> 
   </tr> 
  </tbody> 
 </table> 
 <p>As <code>\psi</code> is used a lot in quantum mechanics, I replace all instances of <code>q</code> in a braket with <code>\psi</code> when expanded.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814342926468/17477.jpg"></p> 
 <div data-language="snip"> 
  <pre><code><span>snippet <span>"\&lt;(.*?)\|" </span><span>"bra"</span> <span>riA</span></span>
\bra{`<span>!p</span><span> snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span><span>.</span>replace<span>(</span><span>'q'</span><span>,</span> f<span>'\psi'</span><span>)</span><span>.</span>replace<span>(</span><span>'f'</span><span>,</span> f<span>'\phi'</span><span>)</span>`</span>}
<span>endsnippet</span>

<span>snippet <span>"\|(.*?)\&gt;" </span><span>"ket"</span> <span>riA</span></span>
\ket{`<span>!p</span><span> snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span><span>.</span>replace<span>(</span><span>'q'</span><span>,</span> f<span>'\psi'</span><span>)</span><span>.</span>replace<span>(</span><span>'f'</span><span>,</span> f<span>'\phi'</span><span>)</span>`</span>}
<span>endsnippet</span>

<span>snippet <span>"(.*)\\bra{(.*?)}([^\|]*?)\&gt;" </span><span>"braket"</span> <span>riA</span></span>
`<span>!p</span><span> snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>1</span><span>)</span>`\braket<span>{</span>`!p snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>2</span><span>)</span>`<span>}</span><span>{</span>`!p snip<span>.</span>rv <span>=</span> match<span>.</span>group<span>(</span><span>3</span><span>)</span><span>.</span>replace<span>(</span><span>'q'</span><span>,</span> f<span>'\psi'</span><span>)</span><span>.</span>replace<span>(</span><span>'f'</span><span>,</span> f<span>'\phi'</span><span>)</span>`</span>}
<span>endsnippet</span></code></pre> 
 </div> 
 <h3>Context</h3> 
 <p>One thing to consider when writing these snippets is, ‘will these snippets collide with usual text?’ For example, according to my dictionary, there are about 72 words in English and 2000 words in Dutch that contain <code>sr</code>, which means that while I’m typing the word <code>disregard</code>, the <code>sr</code> would expand to <code>^2</code>, giving me <code>di^2egard</code>.</p> 
 <p>The solution to this problem is adding a <em>context</em> to snippets. Using the syntax highlighting of Vim, it can be determined whether or not UltiSnips should expand the snippet depending if you’re in math or text. Add the following to the top of your snippets file:</p> 
 <div data-language="python"> 
  <pre><code><span>global</span> !p
<span>def</span> <span>math</span><span>(</span><span>)</span><span>:</span>
    <span>return</span> vim<span>.</span><span>eval</span><span>(</span><span>'vimtex#syntax#in_mathzone()'</span><span>)</span> <span>==</span> <span>'1'</span>

<span>def</span> <span>comment</span><span>(</span><span>)</span><span>:</span> 
    <span>return</span> vim<span>.</span><span>eval</span><span>(</span><span>'vimtex#syntax#in_comment()'</span><span>)</span> <span>==</span> <span>'1'</span>

<span>def</span> <span>env</span><span>(</span>name<span>)</span><span>:</span>
    <span>[</span>x<span>,</span>y<span>]</span> <span>=</span> vim<span>.</span><span>eval</span><span>(</span><span>"vimtex#env#is_inside('"</span> <span>+</span> name <span>+</span> <span>"')"</span><span>)</span> 
    <span>return</span> x <span>!=</span> <span>'0'</span> <span>and</span> x <span>!=</span> <span>'0'</span>

endglobal</code></pre> 
 </div> 
 <p>Now you can add <code>context "math()"</code> to the snippets you’d only want to expand in a mathematical context.</p> 
 <div data-language="snip"> 
  <pre><code><span>context</span> "math()"
<span>snippet <span>sr </span><span>"^2"</span> <span>iA</span></span>
^2
<span>endsnippet</span></code></pre> 
 </div> 
 <p>Note that a ‘mathematical context’ is a subtle thing. Sometimes you add some text inside a math environment by using <code>\text{...}</code>. In that case, you do not want snippets to expand. However, in the following case: <code>\[ \text{$...$} \]</code>, they <em>should</em> expand. The following animation illustrates these subtleties.</p> 
 <p><img src="https://image.cubox.pro/article/2022010814343062423/52748.jpg"></p> 
 <p>Similarly, you can add <code>context "env('itemize')"</code> to snippets that only should expand in an <code>itemize</code> environment or <code>context "comment()"</code> for snippets in comments.</p> 
 <details> <summary> This section was edited on 2020-12-24. The new version of vimtex makes the code for detecting the context a lot simpler. Click to see old version </summary> 
  <div data-language="python"> 
   <pre><code><span>global</span> !p
texMathZones <span>=</span> <span>[</span><span>'texMathZone'</span> <span>+</span> x <span>for</span> x <span>in</span> <span>[</span><span>'A'</span><span>,</span> <span>'AS'</span><span>,</span> <span>'B'</span><span>,</span> <span>'BS'</span><span>,</span> <span>'C'</span><span>,</span> <span>'CS'</span><span>,</span>
<span>'D'</span><span>,</span> <span>'DS'</span><span>,</span> <span>'E'</span><span>,</span> <span>'ES'</span><span>,</span> <span>'F'</span><span>,</span> <span>'FS'</span><span>,</span> <span>'G'</span><span>,</span> <span>'GS'</span><span>,</span> <span>'H'</span><span>,</span> <span>'HS'</span><span>,</span> <span>'I'</span><span>,</span> <span>'IS'</span><span>,</span> <span>'J'</span><span>,</span> <span>'JS'</span><span>,</span>
<span>'K'</span><span>,</span> <span>'KS'</span><span>,</span> <span>'L'</span><span>,</span> <span>'LS'</span><span>,</span> <span>'DS'</span><span>,</span> <span>'V'</span><span>,</span> <span>'W'</span><span>,</span> <span>'X'</span><span>,</span> <span>'Y'</span><span>,</span> <span>'Z'</span><span>,</span> <span>'AmsA'</span><span>,</span> <span>'AmsB'</span><span>,</span> <span>'AmsC'</span><span>,</span>
<span>'AmsD'</span><span>,</span> <span>'AmsE'</span><span>,</span> <span>'AmsF'</span><span>,</span> <span>'AmsG'</span><span>,</span> <span>'AmsAS'</span><span>,</span> <span>'AmsBS'</span><span>,</span> <span>'AmsCS'</span><span>,</span> <span>'AmsDS'</span><span>,</span> <span>'AmsES'</span><span>,</span>
<span>'AmsFS'</span><span>,</span> <span>'AmsGS'</span> <span>]</span><span>]</span>

texIgnoreMathZones <span>=</span> <span>[</span><span>'texMathText'</span><span>]</span>

texMathZoneIds <span>=</span> vim<span>.</span><span>eval</span><span>(</span><span>'map('</span><span>+</span><span>str</span><span>(</span>texMathZones<span>)</span><span>+</span><span>", 'hlID(v:val)')"</span><span>)</span>
texIgnoreMathZoneIds <span>=</span> vim<span>.</span><span>eval</span><span>(</span><span>'map('</span><span>+</span><span>str</span><span>(</span>texIgnoreMathZones<span>)</span><span>+</span><span>", 'hlID(v:val)')"</span><span>)</span>

ignore <span>=</span> texIgnoreMathZoneIds<span>[</span><span>0</span><span>]</span>

<span>def</span> <span>math</span><span>(</span><span>)</span><span>:</span>
	synstackids <span>=</span> vim<span>.</span><span>eval</span><span>(</span><span>"synstack(line('.'), col('.') - (col('.')&gt;=2 ? 1 : 0))"</span><span>)</span>
	<span>try</span><span>:</span>
		first <span>=</span> <span>next</span><span>(</span>
            i <span>for</span> i <span>in</span> <span>reversed</span><span>(</span>synstackids<span>)</span>
            <span>if</span> i <span>in</span> texIgnoreMathZoneIds <span>or</span> i <span>in</span> texMathZoneIds
        <span>)</span>
		<span>return</span> first <span>!=</span> ignore
	<span>except</span> StopIteration<span>:</span>
		<span>return</span> <span>False</span>
endglobal</code></pre> 
  </div> 
 </details> 
 <h2>Correcting spelling mistakes on the fly</h2> 
 <p>While inserting mathematics is an important part of my note-taking setup, most of the time I’m typing English. At about 80 words per minute, my typing skills are not bad, but I still make a lot of typos. This is why I added a keybinding to Vim that corrects the spelling mistakes, without interrupting my flow. When I press <kbd>Ctrl+L</kbd> while I’m typing, the previous spelling mistake is corrected. It looks like this:</p> 
 <p><img src="https://image.cubox.pro/article/2022010814343075080/89188.jpg"></p> 
 <p>My configuration for spell check is the following:</p> 
 <div data-language="vim"> 
  <pre><code><span>setlocal</span> <span>spell</span>
<span>set</span> <span>spelllang</span><span>=</span>nl<span>,</span>en_gb
inoremap <span>&lt;</span>C<span>-</span><span>l</span><span>&gt;</span> <span>&lt;</span><span>c</span><span>-</span>g<span>&gt;</span><span>u</span><span>&lt;</span>Esc<span>&gt;</span><span>[</span>s1z<span>=</span>`<span>]</span>a<span>&lt;</span><span>c</span><span>-</span>g<span>&gt;</span><span>u</span></code></pre> 
 </div> 
 <p>It basically jumps to the previous spelling mistake <code>[s</code>, then picks the first suggestion <code>1z=</code>, and then jumps back <code>`]a</code>. The <code>&lt;c-g&gt;u</code> in the middle make it possible to undo the spelling correction quickly.</p> 
 <h2>In conclusion</h2> 
 <p>Using snippets in Vim, writing LaTeX is no longer an annoyance, but rather a pleasure. In combination with spell check on the fly, it allows for a comfortable mathematical note-taking setup. A few pieces are missing though, for example drawing figures digitally and embedding them in a LaTeX document. This is a topic I’d like to tackle in a future blog post.</p> 
 <p>Liked this blog post? Consider <a href="https://castel.dev/coffee" target="_blank">buying me a coffee</a>!</p> 
</div><p class="reader-footer"><a class="reader-footer-source" href="https://castel.dev/post/lecture-notes-1/" target="_blank"><span class="reader-footer-source-label">查看原网页: </span>castel.dev </a></p></div></div><script type="text/javascript" src="https://cubox.pro/article/js/reader.js"></script><script type="text/javascript" src="https://cubox.pro/article/js/mark.js"></script></body></html>